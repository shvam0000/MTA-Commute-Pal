<!DOCTYPE html>
<html>
  <head>
    <title>Data Fetch and Heatmap Example</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <div class="dropdown-container">
      <label for="dateDropdown">Select Date:</label>
      <select id="dateDropdown">
        <option value="2023-09-24">2023-09-24 (Friday)</option>
        <option value="2023-09-25">2023-09-25 (Saturday)</option>
        <option value="2023-09-26">2023-09-26 (Sunday)</option>
        <option value="2023-09-27">2023-09-27 (Monday)</option>
        <option value="2023-09-28">2023-09-28 (Tuesday)</option>
        <option value="2023-09-29">2023-09-29 (Wednesday)</option>
        <option value="2023-09-30">2023-09-30 (Thursday)</option>
      </select>

      <label for="timeDropdown">Select Time:</label>
      <select id="timeDropdown">
        <option value="T00:00:00.000">00:00</option>
        <option value="T01:00:00.000">01:00</option>
        <option value="T02:00:00.000">02:00</option>
        <option value="T03:00:00.000">03:00</option>
        <option value="T04:00:00.000">04:00</option>
        <option value="T05:00:00.000">05:00</option>
        <option value="T06:00:00.000">06:00</option>
        <option value="T07:00:00.000">07:00</option>
        <option value="T08:00:00.000">08:00</option>
        <option value="T09:00:00.000">09:00</option>
        <option value="T10:00:00.000">10:00</option>
        <option value="T11:00:00.000">11:00</option>
        <option value="T12:00:00.000">12:00</option>
        <option value="T13:00:00.000">13:00</option>
        <option value="T14:00:00.000">14:00</option>
        <option value="T15:00:00.000">15:00</option>
        <option value="T16:00:00.000">16:00</option>
        <option value="T17:00:00.000">17:00</option>
        <option value="T18:00:00.000">18:00</option>
        <option value="T19:00:00.000">19:00</option>
        <option value="T20:00:00.000">20:00</option>
        <option value="T21:00:00.000">21:00</option>
        <option value="T22:00:00.000">22:00</option>
        <option value="T23:00:00.000">23:00</option>
      </select>
    </div>
    <div
      id="map"
      style="height: 650px; width: 100%; margin: 0; padding: 0"
    ></div>

    <script>
      var map;
      var heatmap;
      var dateDropdown;
      var timeDropdown;

      function initMap() {
        dateDropdown = document.getElementById('dateDropdown');
        timeDropdown = document.getElementById('timeDropdown');

        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: { lat: 40.79059982299805, lng: -73.94747924804688 },
        });

        // Create an InfoWindow for the popup
        var infoWindow = new google.maps.InfoWindow();
        function update() {
          var selectedDate = dateDropdown.value;
          var selectedTime = timeDropdown.value;
          updateData(selectedDate, selectedTime);
        }

        // Function to update the heatmap
        function updateData(date, time) {
          const timestamp = date + time;
          fetch(
            'https://data.ny.gov/resource/wujg-7c2s.json?transit_timestamp=' +
              timestamp
          )
            .then((response) => response.json())
            .then((data) => {
              // Process and create heatmapData with weights from the 'ridership' field
              var heatmapData = data.map(function (item) {
                var latitude = parseFloat(item.latitude);
                var longitude = parseFloat(item.longitude);
                var ridership = parseFloat(item.ridership);

                return {
                  location: new google.maps.LatLng(latitude, longitude),
                  weight: ridership, // Use 'ridership' as the weight
                };
              });

              // Create a heatmap layer with weights
              heatmap.setData(heatmapData);
            })
            .catch((error) => {
              console.error('Error fetching data:', error);
            });
        }

        // Create the heatmap layer
        heatmap = new google.maps.visualization.HeatmapLayer({
          data: [], // Initially, no data
          map: map,
        });

        // Set gradient colors (optional)

        // Customize heatmap options (e.g., radius and opacity)
        heatmap.set('radius', 50);
        heatmap.set('opacity', 0.7);

        // Initialize the date and time dropdowns
        dateDropdown.value = '2023-09-24';
        timeDropdown.value = 'T00:00:00.000';

        // Event listeners for date and time dropdowns
        dateDropdown.addEventListener('change', update);
        timeDropdown.addEventListener('change', update);

        // Initial data load
        updateData('2023-09-24', 'T00:00:00.000');
      }
    </script>
    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=API_KEY&libraries=visualization&callback=initMap"
    ></script>
  </body>
</html>
